@page "/book/{Id:int}"

@if (!IsLoading)
{
    @if (MainBook != null)
    {
        <MudPaper Class="main-book-details" Elevation="4" Style="padding:24px; margin-bottom:32px;">
            <MudText Typo="Typo.h4">@MainBook.Title</MudText>
            <MudImage Src="@MainBook.ImageUrl" Alt="@MainBook.Title" Width="200" Style="margin:16px 0;"/>
            <MudText Typo="Typo.subtitle1">Author: @MainBook.Authors.Split(",").First()</MudText>
        </MudPaper>
        <AuthorizeView>
            <Authorized>
                
                <MudRating SelectedValueChanged="Rate" SelectedValue="UserRating" MaxValue="5" Size="Size.Large" Color="Color.Primary" Style="margin-bottom: 16px;" />
                <MudTextField @bind-Value="CommentText" Label="Add a comment" Variant="Variant.Outlined"
                              Margin="Margin.Dense" Style="width: 100%;"/>
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@(PostCommentAsync)">Post Comment
                </MudButton>
                <MudIconButton Icon="@Icons.Material.Filled.ThumbUp" Color="Color.Primary"
                               OnClick="@(() => Read ? RemoveBookFromReadAsync() : AddBookAsReadAsync())" Style="margin-left: 8px;" Variant="@(Read ? Variant.Filled : default)"/>
                <MudIconButton Icon="@Icons.Material.Filled.Bookmark" Color="Color.Secondary"
                               OnClick="@(() => ToBeRead ? RemoveBookFromWantToReadAsync() : AddBookToWantToReadAsync())" Style="margin-left: 8px;" Variant="@(ToBeRead ? Variant.Filled : default)"/>
            </Authorized>
            <NotAuthorized>
                <MudText Typo="Typo.h6" GutterBottom="true">You need to log in to add comments or rate this book.</MudText>
                <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/Account/Login"
                           Style="margin-top: 8px;">
                    Log In
                </MudButton>
            </NotAuthorized>
        </AuthorizeView>
        if (Comments.Count > 0)
        {
            <MudText Typo="Typo.h6" GutterBottom="true">Comments</MudText>
            <div style="margin-bottom: 16px;">
                @foreach (var comment in Comments)
                {
                    <MudPaper Class="comment" Elevation="1" Style="padding:16px; margin-bottom:8px;">
                        <MudText Typo="Typo.body1">@comment.Text</MudText>
                        <MudText Typo="Typo.caption" Style="color: gray;">- @comment.UserName</MudText>
                    </MudPaper>
                }
            </div>
        }
        else
        {
            <MudText Typo="Typo.body2">No comments available.</MudText>
        }
    }

    @if (RecommendedBooks.Count > 0)
    {
        <MudText Typo="Typo.h6" GutterBottom="true">Related Books</MudText>
        <div style="display: flex; flex-wrap: wrap; gap: 16px; padding-bottom: 8px;">
            @foreach (var book in RecommendedBooks)
            {
                <MudCard Style="width:220px; height:320px;">
                    <MudCardMedia Image="@book.ImageUrl" Height="180"/>
                    <MudCardContent>
                        <MudText Typo="Typo.subtitle2">@book.Title</MudText>
                        <MudText Typo="Typo.body2">@book.Authors.Split(",").First()</MudText>
                    </MudCardContent>
                </MudCard>
            }
        </div>
    }
    else
    {
        <MudText Typo="Typo.body2">No related books found.</MudText>
    }
}
else
{
    <MudProgressCircular Indeterminate="true" Color="Color.Primary" Style="margin: 20px auto; display: block;"/>
}


